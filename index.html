<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e40af; --bg: #f1f5f9; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); padding: 15px; }
        .card { background: white; max-width: 450px; margin: auto; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Forces all text typed into inputs to appear as Uppercase */
        input { 
            width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 6px; 
            text-transform: uppercase; box-sizing: border-box; 
        }
        
        label { font-size: 0.85rem; font-weight: 600; color: #475569; display: block; margin-top: 15px; }
        button { 
            width: 100%; background: var(--primary); color: white; border: none; padding: 15px; 
            border-radius: 6px; font-weight: 600; margin-top: 25px; cursor: pointer;
        }
        #loader { display: none; text-align: center; font-weight: bold; color: var(--primary); margin-top: 10px; }
        .readonly-name { background: #f8fafc; color: #64748b; font-style: italic; }
    </style>
</head>
<body>

<div class="card">
    <h3 style="text-align:center; margin-top:0;">Receipt Tool</h3>
    <form id="receiptForm">
        <label>RECEIPT NO</label>
        <input type="text" name="receipt_no" placeholder="E.G. 001/26" required>

        <label>UNIT (TYPE UNIT TO LOAD NAME)</label>
        <input type="text" id="unitInput" name="unit" placeholder="E.G. C4" required>

        <label>NAME (AUTO-FILLED)</label>
        <input type="text" id="nameDisplay" name="name" class="readonly-name" readonly placeholder="NAME WILL APPEAR HERE">

        <label>DATE</label>
        <input type="date" name="date" required>

        <label>AMOUNT (FIGURES ONLY)</label>
        <input type="number" name="amount" placeholder="E.G. 50000" required>

        <label>BEING PAYMENT OF</label>
        <input type="text" name="payment_for" placeholder="E.G. JANUARY ENERGY BILL" required>

        <button type="submit" id="btn">GENERATE & DOWNLOAD PDF</button>
    </form>
    <div id="loader">PROCESSING... PLEASE WAIT</div>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzKFDBxvbkU9rrNIHp1Sak30nbMevnDQwSdF3GrP79KIyVy8YI-D9Q3xzEKvMplbSa61Q/exec"; // REPLACE THIS

    // LISTEN FOR UNIT INPUT TO PULL NAME
    document.getElementById('unitInput').addEventListener('blur', async (e) => {
        const unit = e.target.value.trim();
        if (unit.length > 0) {
            document.getElementById('nameDisplay').value = "SEARCHING...";
            const response = await fetch(`${WEB_APP_URL}?action=getName&unit=${unit}`);
            const name = await response.text();
            document.getElementById('nameDisplay').value = name;
        }
    });

    // FORM SUBMISSION
    document.getElementById('receiptForm').onsubmit = async (e) => {
        e.preventDefault();
        document.getElementById('btn').disabled = true;
        document.getElementById('loader').style.display = 'block';

        const formData = new FormData(e.target);
        
        try {
            const response = await fetch(WEB_APP_URL, { method: 'POST', body: formData });
            const result = await response.json();
            if(result.status === 'success') {
                window.location.href = result.url; // Opens the PDF
            } else {
                alert("Error: " + result.message);
            }
        } catch (err) {
            alert("Connection error. Ensure Web App is deployed as 'Anyone'.");
        }
        
        document.getElementById('btn').disabled = false;
        document.getElementById('loader').style.display = 'none';
    };
</script>

</body>
</html>
